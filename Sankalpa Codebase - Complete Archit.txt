Sankalpa Codebase - Complete Architecture Analysis

  Executive Summary

  Sankalpa is a production-ready, enterprise-grade multi-agent AI platform for autonomous software development. It is NOT just a chat system, but a comprehensive platform for:
  - Autonomous AI software development
  - GPT/ML/LLM model creation and fine-tuning
  - Multi-agent coordination for complex tasks
  - Self-replicating agents
  - Full-stack application generation
  - Visual drag-and-drop workflow composer
  - Marketplace-ready framework for SaaS commercialization

  ---
  1. Directory Structure Overview

  G:\mcp\sankalpa\
  ├── agents/                    # 35+ AI agents across 9 categories
  │   ├── base.py               # BaseAgent abstract class
  │   ├── enhanced_base.py      # Enhanced agent with logging/validation
  │   ├── loader.py             # Dynamic agent loading
  │   ├── chain_manager.py      # Sequential agent chaining
  │   ├── enhanced_chain_manager.py  # Advanced chain orchestration
  │   ├── builder/              # 11 builder agents
  │   ├── testing/              # 4 testing agents
  │   ├── deployment/           # 3 deployment agents
  │   ├── marketing/            # 4 marketing agents
  │   ├── enhanced/             # 6 enhanced agents
  │   ├── meta/                 # 2 meta agents
  │   ├── orchestration/        # 3 orchestration agents
  │   ├── implementation/       # 2 implementation agents
  │   └── custom/               # 5 custom agents
  ├── backend/                   # FastAPI backend
  │   ├── enhanced_main.py      # Production API server (308 lines)
  │   ├── routers/              # API endpoint handlers
  │   │   ├── agents.py         # Agent execution endpoints
  │   │   ├── chains.py         # Chain definition/execution
  │   │   ├── memory.py         # Memory management API
  │   │   └── users.py          # User authentication
  │   ├── db/                   # Database layer
  │   │   ├── database.py       # SQLAlchemy setup
  │   │   └── models.py         # ORM models (User, Role, Chain)
  │   ├── websockets/           # Real-time communication
  │   └── middleware/           # Request middleware
  ├── core/                      # Core services
  │   ├── config.py             # Singleton configuration
  │   ├── security.py           # JWT, RBAC, rate limiting
  │   ├── caching.py            # Redis/in-memory caching
  │   ├── monitoring.py         # System metrics & health
  │   └── logging.py            # Structured logging
  ├── memory/                    # Memory management system
  │   ├── memory_manager.py     # Basic JSON persistence
  │   └── enhanced_memory_manager.py  # Transactions, backups
  ├── frontend/                  # Next.js 14 web application
  │   ├── pages/                # 14+ pages
  │   ├── components/           # 20+ React components
  │   ├── lib/api-client.ts     # Axios API client (641 lines)
  │   └── hooks/                # React hooks
  ├── marketplace/               # Agent marketplace
  ├── tenants/                   # Multi-tenancy support
  ├── integrations/              # External integrations
  │   └── github/               # GitHub API client
  ├── nlp/                       # NLP processing
  ├── fine_tuning/               # ML fine-tuning
  ├── tests/                     # Test suites
  ├── cli/                       # Command-line interface
  ├── docs/                      # Documentation
  └── .github/workflows/         # CI/CD pipelines

  ---
  2. Backend Architecture

  2.1 FastAPI Server (backend/enhanced_main.py)

  - Framework: FastAPI 0.103.1 with Uvicorn
  - Port: 9000 (development) / 8000 (production)
  - Features:
    - CORS middleware with configurable origins
    - Security headers (XSS, Content-Type, Frame Options)
    - Metrics middleware for performance tracking
    - JWT authentication with refresh tokens
    - Rate limiting per IP address
    - Comprehensive health check endpoints

  2.2 API Routers

  | Router           | Endpoints | Description                               |
  |------------------|-----------|-------------------------------------------|
  | /api/agents      | 10+       | Agent listing, execution, enhanced agents |
  | /api/chains      | 5+        | Chain definition, execution, management   |
  | /api/memory      | 6+        | Session management, key-value storage     |
  | /api/users       | 6+        | Authentication, user management           |
  | /api/marketplace | 10+       | Item listing, reviews, categories         |

  2.3 Database Layer

  ORM Models (backend/db/models.py):
  - User - Authentication with roles
  - Role, Permission, UserRole, RolePermission - RBAC system
  - ApiKey - Programmatic API access
  - Chain, MemorySession - Domain models

  Connection: PostgreSQL via SQLAlchemy 2.0.20

  ---
  3. Agent System Architecture

  3.1 Agent Base Classes

  BaseAgent (agents/base.py):
  class BaseAgent(ABC):
      @abstractmethod
      def run(self, input_data: dict) -> dict:
          pass

  EnhancedBaseAgent (agents/enhanced_base.py):
  - Automatic logging
  - Input validation
  - Error handling with retries
  - Memory integration
  - Execution metrics

  3.2 Agent Categories (35+ Agents)

  | Category       | Count | Key Agents                                                                                        |
  |----------------|-------|---------------------------------------------------------------------------------------------------|
  | Builder        | 11    | ProjectArchitect, FrontendBuilder, BackendBuilder, APIBuilder, DBSchema, UIGenerator, AuthBuilder |
  | Testing        | 4     | TestSuite, IntegrationTest, SecurityScanner, Critic                                               |
  | Deployment     | 3     | DeployExecutor (Vercel/AWS/GCP/Azure), CIGenerator, DomainLinker                                  |
  | Marketing      | 4     | READMEWriter, SEOOptimizer, ProductHuntCopywriter, PitchDeckGenerator                             |
  | Enhanced       | 6     | Copilot, SelfReplicator, Finetuner, PluginLoader, VSCodeExtension, CLIRunner                      |
  | Meta           | 2     | MultiAgentMemoryManager, VersionTracker                                                           |
  | Orchestration  | 3     | Planner, ExecutionManager, SessionReplayer                                                        |
  | Implementation | 2     | DBPersistence, HealthCheck                                                                        |
  | Custom         | 5     | HelloWorld, Calculator, Translator, DateFormatter, CodeSummarizer                                 |

  3.3 Chain Management

  ChainManager (agents/chain_manager.py):
  - Sequential agent execution
  - Memory persistence between steps
  - Error propagation

  EnhancedChainManager (agents/enhanced_chain_manager.py):
  - Parallel execution support
  - Conditional branching
  - Execution callbacks
  - Progress tracking

  ---
  4. Core Services

  4.1 Configuration (core/config.py)

  - Singleton pattern
  - Environment-based configuration
  - Sections: app, api, security, memory, agents, logging

  4.2 Security (core/security.py - 308 lines)

  - JWT Authentication: Access + refresh tokens
  - RBAC: Role-based access control
  - Password Hashing: bcrypt
  - Rate Limiting: Configurable per endpoint
  - Security Headers: XSS, CSRF, Content-Type

  4.3 Caching (core/caching.py - 297 lines)

  - Multi-level: In-memory → Redis → Database
  - Decorators: @cached(key, ttl)
  - Automatic invalidation

  4.4 Monitoring (core/monitoring.py - 300 lines)

  - System metrics (CPU, memory, disk)
  - Request latency tracking
  - Agent execution metrics
  - Health check endpoints

  ---
  5. Memory System

  5.1 Basic Memory Manager

  - JSON file persistence
  - Key-value storage
  - Session-based isolation

  5.2 Enhanced Memory Manager (memory/enhanced_memory_manager.py - 358 lines)

  - Transactional writes with atomic operations
  - Backup/restore functionality
  - Multi-session support
  - Context manager for transactions:
  with memory.transaction() as txn:
      txn.save("key1", value1)
      txn.save("key2", value2)
      # Auto-commit or rollback

  ---
  6. Frontend Architecture

  6.1 Technology Stack

  - Framework: Next.js 14.0.0
  - UI Library: React 18.2.0
  - Visualization: ReactFlow 11.11.4, Recharts 2.15.2
  - Styling: TailwindCSS 3.3.3
  - HTTP Client: Axios 1.5.0
  - AI Integration: OpenAI SDK 4.35.0

  6.2 Key Pages

  | Page         | Description                           |
  |--------------|---------------------------------------|
  | /            | Homepage                              |
  | /composer    | Visual workflow composer (1021 lines) |
  | /playground  | Interactive agent testing             |
  | /memory      | Memory browser                        |
  | /dashboard   | System dashboard                      |
  | /chat        | Chat interfaces                       |
  | /agents/*    | Agent listing and details             |
  | /marketplace | Agent marketplace                     |

  6.3 Workflow Composer Features

  - Drag-and-drop agent nodes
  - Visual edge connections
  - Real-time execution with progress
  - Template workflows
  - Save/load JSON workflows
  - Simulated and real API execution

  6.4 API Client (frontend/lib/api-client.ts - 641 lines)

  - Full TypeScript implementation
  - Token refresh interceptor
  - Error handling with retry
  - Complete API coverage:
    - Agents, Chains, Memory, Workflows
    - Fine-tuning, Marketplace
    - Authentication

  ---
  7. Integration Modules

  7.1 Marketplace (marketplace/)

  - Models: MarketplaceItem, Review, Category, Collection
  - Features: Filtering, sorting, ratings, caching
  - Monetization-ready for SaaS

  7.2 Multi-Tenancy (tenants/)

  - Models: Tenant, TenantUser, TenantInvitation, TenantApiKey
  - Features: Custom domains, branding, resource limits

  7.3 GitHub Integration (integrations/github/client.py - 451 lines)

  - Repository management
  - File operations (read/write)
  - Pull request creation
  - GitHub Actions workflow management

  ---
  8. Testing Infrastructure

  8.1 Test Structure

  tests/
  ├── conftest.py              # Pytest fixtures
  ├── comprehensive_test_suite.py
  ├── unit/                    # Unit tests
  │   ├── agents/
  │   ├── chain_manager/
  │   └── memory/
  ├── integration/             # Integration tests
  │   ├── api/
  │   └── agents/
  ├── e2e/                     # End-to-end tests
  ├── security/                # Security tests
  ├── performance/             # Performance benchmarks
  └── frontend/                # React component tests

  8.2 CI/CD Pipeline (.github/workflows/ci.yml)

  - Lint: flake8, black, isort
  - Backend Tests: pytest with coverage
  - Frontend Tests: npm test
  - Docker Build: Multi-stage builds
  - Services: PostgreSQL 14, Redis 7

  ---
  9. Deployment Architecture

  9.1 Docker Compose

  services:
    backend:    # FastAPI on port 9000
    frontend:   # Next.js on port 9001
    postgres:   # PostgreSQL on port 5432
    redis:      # Redis on port 6379

  9.2 Deployment Targets

  - Vercel: Frontend deployment
  - AWS: CloudFormation, S3, CloudFront, Elastic Beanstalk
  - GCP: App Engine, Firebase Hosting
  - Azure: Static Web Apps, App Service

  ---
  10. Integration Protocols

  As documented in documents/PROTOCOLS_USED.md:

  | Protocol     | Purpose                              |
  |--------------|--------------------------------------|
  | LangChain    | Agent chaining, memory recall        |
  | MCP          | Model Context Protocol integration   |
  | CrewAI       | Multi-agent collaboration            |
  | AutoGen      | Task planning, self-expanding agents |
  | ReAct        | Reasoning + tool use                 |
  | PromptFlow   | Visual workflow UI                   |
  | GPT Engineer | Project generation                   |
  | BabyAGI      | Task planning                        |

  ---
  11. Codebase Statistics

  | Metric                       | Count   |
  |------------------------------|---------|
  | Python files                 | 134     |
  | TypeScript/React files       | 35+     |
  | Total agents                 | 35+     |
  | API endpoints                | 40+     |
  | Test modules                 | 20+     |
  | Documentation files          | 21      |
  | Lines of backend Python      | ~8,700  |
  | Lines of frontend TypeScript | ~5,000+ |

  ---
  12. Key Entry Points

  | Entry Point              | Purpose                                   |
  |--------------------------|-------------------------------------------|
  | run_sankalpa.py          | Full system launcher (backend + frontend) |
  | backend/enhanced_main.py | Production API server                     |
  | frontend/package.json    | Next.js development server                |
  | docker-compose.yml       | Container orchestration                   |
  | cli/cli.py               | Command-line interface                    |

  ---

● 13. Architecture Summary Diagram

  ┌─────────────────────────────────────────────────────────────────────────────┐
  │                              SANKALPA PLATFORM                               │
  ├─────────────────────────────────────────────────────────────────────────────┤
  │                                                                             │
  │  ┌─────────────────────────────────────────────────────────────────────┐   │
  │  │                         PRESENTATION LAYER                           │   │
  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │
  │  │  │  Composer    │  │  Playground  │  │  Dashboard   │              │   │
  │  │  │  (ReactFlow) │  │  (Testing)   │  │  (Metrics)   │              │   │
  │  │  └──────────────┘  └──────────────┘  └──────────────┘              │   │
  │  │                       Next.js 14 + TailwindCSS                       │   │
  │  └─────────────────────────────────────────────────────────────────────┘   │
  │                                    │                                        │
  │                                    ▼                                        │
  │  ┌─────────────────────────────────────────────────────────────────────┐   │
  │  │                           API LAYER                                  │   │
  │  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐           │   │
  │  │  │ /agents  │  │ /chains  │  │ /memory  │  │ /users   │           │   │
  │  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘           │   │
  │  │                     FastAPI + JWT + RBAC                            │   │
  │  └─────────────────────────────────────────────────────────────────────┘   │
  │                                    │                                        │
  │                                    ▼                                        │
  │  ┌─────────────────────────────────────────────────────────────────────┐   │
  │  │                        CORE SERVICES                                 │   │
  │  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐           │   │
  │  │  │ Security │  │ Caching  │  │Monitoring│  │ Logging  │           │   │
  │  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘           │   │
  │  └─────────────────────────────────────────────────────────────────────┘   │
  │                                    │                                        │
  │                                    ▼                                        │
  │  ┌─────────────────────────────────────────────────────────────────────┐   │
  │  │                         AGENT LAYER (35+ Agents)                     │   │
  │  │  ┌────────────────────────────────────────────────────────────────┐ │   │
  │  │  │ Builder(11) │ Testing(4) │ Deploy(3) │ Marketing(4) │ Meta(2) │ │   │
  │  │  └────────────────────────────────────────────────────────────────┘ │   │
  │  │  ┌────────────────────────────────────────────────────────────────┐ │   │
  │  │  │ Enhanced(6): SelfReplicator, Finetuner, Copilot, VSCode, etc.  │ │   │
  │  │  └────────────────────────────────────────────────────────────────┘ │   │
  │  │                    Chain Manager + Memory System                     │   │
  │  └─────────────────────────────────────────────────────────────────────┘   │
  │                                    │                                        │
  │                                    ▼                                        │
  │  ┌─────────────────────────────────────────────────────────────────────┐   │
  │  │                          DATA LAYER                                  │   │
  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │
  │  │  │  PostgreSQL  │  │    Redis     │  │ File System  │              │   │
  │  │  │  (Users,     │  │  (Caching,   │  │  (Sessions,  │              │   │
  │  │  │   Chains)    │  │   Sessions)  │  │   Agents)    │              │   │
  │  │  └──────────────┘  └──────────────┘  └──────────────┘              │   │
  │  └─────────────────────────────────────────────────────────────────────┘   │
  │                                                                             │
  ├─────────────────────────────────────────────────────────────────────────────┤
  │  INTEGRATIONS: GitHub │ Marketplace │ Multi-Tenancy │ NLP │ Fine-Tuning    │
  └─────────────────────────────────────────────────────────────────────────────┘

  ---
  Analysis Complete

  This is a comprehensive, enterprise-grade AI development platform with:

  1. 35+ specialized AI agents across 9 categories for autonomous software development
  2. Full-stack architecture with FastAPI backend and Next.js frontend
  3. Visual workflow composer using ReactFlow for drag-and-drop agent orchestration
  4. Enterprise features: JWT auth, RBAC, multi-tenancy, marketplace
  5. Production-ready: Docker deployment, CI/CD pipelines, comprehensive testing
  6. Self-improving capabilities: Agent self-replication, LLM fine-tuning
  7. Multi-platform deployment: Vercel, AWS, GCP, Azure support